<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>Beacon.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">com.irurueta:irurueta-navigation</a> &gt; <a href="index.source.html" class="el_package">com.irurueta.navigation.indoor</a> &gt; <span class="el_source">Beacon.java</span></div><h1>Beacon.java</h1><pre class="source lang-java linenums">/*
 * Copyright (C) 2018 Alberto Irurueta Carro (alberto@irurueta.com)
 *
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *         http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
package com.irurueta.navigation.indoor;

import java.io.Serializable;
import java.util.Collections;
import java.util.List;

/**
 * The &lt;code&gt;Beacon&lt;/code&gt; class represents a single hardware Beacon detected by
 * an Android device.
 *
 * &lt;pre&gt;A Beacon is identified by a unique multi-part identifier, with the first of the ordered
 * identifiers being more significant for the purposes of grouping beacons.
 *
 * A Beacon sends a Bluetooth Low Energy (BLE) advertisement that contains these
 * three identifiers, along with the calibrated tx power (in RSSI) of the Beacon's
 * Bluetooth transmitter.
 * &lt;/pre&gt;
 *
 * Based on: https://github.com/AltBeacon/android-beacon-library/blob/master/src/main/java/org/altbeacon/beacon/Beacon.java
 */
@SuppressWarnings(&quot;WeakerAccess&quot;)
public class Beacon implements Serializable, RadioSource {

    /**
     * Default frequency used by a Beacon when none is specified (expressed in Hz).
     */
    public static final double DEFAULT_FREQUENCY = 2.4e9;

    /**
     * The list of the multi-part identifiers of the beacon. Together, these identifiers signify
     * a unique beacon. The identifiers are ordered by significance for the purpose of grouping
     * beacons.
     */
    protected List&lt;BeaconIdentifier&gt; mIdentifiers;

    /**
     * The calibrated measured Tx power of the Beacon in RSSI (expressed in dBm's).
     * This value is baked into a Beacon when it is manufactured, and it is
     * transmitted with each packet to aid in the distance estimate.
     */
    protected double mTransmittedPower;

    /**
     * The Bluetooth mac address.
     */
    protected String mBluetoothAddress;

    /**
     * The two byte value indicating the type of beacon that this is, which is used for figuring
     * out the byte layout of the beacon advertisement.
     */
    protected int mBeaconTypeCode;

    /**
     * A two byte code indicating the beacon manufacturer. A list of registered manufacturer codes
     * may be found here:
     * https://www.bluetooth.org/en-us/specification/assigned-numbers/company-identifiers
     *
     * If the beacon is a GATT-based beacon, this field will be set to -1.
     */
    protected int mManufacturer;

    /**
     * A 32 bit service uuid for the beacon.
     * This is valid only for GATT-based beacons. If the beacon is a manufacturer data-based
     * beacon, this field will be -1
     */
<span class="fc" id="L83">    protected int mServiceUuid = -1;</span>

    /**
     * The Bluetooth device name.  This is a field transmitted by the remote beacon device separate
     * from the advertisement data
     */
    protected String mBluetoothName;

    /**
     * Frequency used by this Beacon(expressed in Hz).
     */
<span class="fc" id="L94">    private double mFrequency = DEFAULT_FREQUENCY;</span>

    /**
     * Constructor.
     * @param identifiers list of the multi-part identifiers of the beacon.
     * @param transmittedPower calibrated measured Tx power of the Beacon in RSSI (expressed in dBm's).
     * @throws IllegalArgumentException if identifiers is null.
     */
    public Beacon(List&lt;BeaconIdentifier&gt; identifiers,
<span class="fc" id="L103">            double transmittedPower) throws IllegalArgumentException {</span>
<span class="fc bfc" id="L104" title="All 2 branches covered.">        if (identifiers == null) {</span>
<span class="fc" id="L105">            throw new IllegalArgumentException();</span>
        }

<span class="fc" id="L108">        mIdentifiers = identifiers;</span>
<span class="fc" id="L109">        mTransmittedPower = transmittedPower;</span>
<span class="fc" id="L110">    }</span>

    /**
     * Constructor.
     * @param identifiers list of the multi-part identifiers of the beacon.
     * @param transmittedPower calibrated measured Tx power of the Beacon in RSSI (expressed in dBm's).
     * @param bluetoothAddress the bluetooth mac addres.
     * @param beaconTypeCode the two byte value indicating the type of beacon.
     * @param manufacturer a two byte code indicating the beacon manufacturer.
     * @param serviceUuid a 32 bit service uuid for the beacon.
     * @param bluetoothName the bluetooth device name.
     * @throws IllegalArgumentException if identifiers is null.
     */
    public Beacon(List&lt;BeaconIdentifier&gt; identifiers,
            double transmittedPower, String bluetoothAddress,
            int beaconTypeCode, int manufacturer,
            int serviceUuid, String bluetoothName)
            throws IllegalArgumentException {
<span class="fc" id="L128">        this(identifiers, transmittedPower);</span>

<span class="fc" id="L130">        mBluetoothAddress = bluetoothAddress;</span>
<span class="fc" id="L131">        mBeaconTypeCode = beaconTypeCode;</span>
<span class="fc" id="L132">        mManufacturer = manufacturer;</span>
<span class="fc" id="L133">        mServiceUuid = serviceUuid;</span>
<span class="fc" id="L134">        mBluetoothName = bluetoothName;</span>
<span class="fc" id="L135">    }</span>

    /**
     * Constructor.
     * @param identifiers list of the multi-part identifiers of the beacon.
     * @param transmittedPower calibrated measured Tx power of the Beacon in RSSI (expressed in dBm's).
     * @param frequency frequency used by this Beacon.
     * @throws IllegalArgumentException if identifiers is null or frequency is negative.
     */
    public Beacon(List&lt;BeaconIdentifier&gt; identifiers,
                  double transmittedPower, double frequency) throws IllegalArgumentException {
<span class="fc" id="L146">        this(identifiers, transmittedPower);</span>

<span class="fc bfc" id="L148" title="All 2 branches covered.">        if (frequency &lt; 0.0) {</span>
<span class="fc" id="L149">            throw new IllegalArgumentException();</span>
        }

<span class="fc" id="L152">        mFrequency = frequency;</span>
<span class="fc" id="L153">    }</span>

    /**
     * Constructor.
     * @param identifiers list of the multi-part identifiers of the beacon.
     * @param transmittedPower calibrated measured Tx power of the Beacon in RSSI (expressed in dBm's).
     * @param frequency frequency used by this Beacon.
     * @param bluetoothAddress the bluetooth mac addres.
     * @param beaconTypeCode the two byte value indicating the type of beacon.
     * @param manufacturer a two byte code indicating the beacon manufacturer.
     * @param serviceUuid a 32 bit service uuid for the beacon.
     * @param bluetoothName the bluetooth device name.
     * @throws IllegalArgumentException if identifiers is null.
     */
    public Beacon(List&lt;BeaconIdentifier&gt; identifiers,
            double transmittedPower, double frequency,
            String bluetoothAddress, int beaconTypeCode,
            int manufacturer, int serviceUuid,
            String bluetoothName)
            throws IllegalArgumentException {
<span class="fc" id="L173">        this(identifiers, transmittedPower, bluetoothAddress, beaconTypeCode,</span>
                manufacturer, serviceUuid, bluetoothName);

<span class="fc bfc" id="L176" title="All 2 branches covered.">        if (frequency &lt; 0.0) {</span>
<span class="fc" id="L177">            throw new IllegalArgumentException();</span>
        }

<span class="fc" id="L180">        mFrequency = frequency;</span>
<span class="fc" id="L181">    }</span>

    /**
     * Empty constructor.
     */
<span class="fc" id="L186">    protected Beacon() { }</span>

    /**
     * Returns the specified identifier - 0 indexed.
     * Note: to read id1, call getIdentifier(0);
     * @param i index identifier.
     * @return identifier or null if not available.
     */
    public BeaconIdentifier getIdentifier(int i) {
<span class="pc bpc" id="L195" title="1 of 6 branches missed.">        if (i &lt; 0 || mIdentifiers == null || mIdentifiers.size() &lt;= i) {</span>
<span class="fc" id="L196">            return null;</span>
        }
<span class="fc" id="L198">        return mIdentifiers.get(i);</span>
    }

    /**
     * Convenience method to get the first identifier.
     * @return first identifier or null if not available.
     */
    public BeaconIdentifier getId1() {
<span class="fc bfc" id="L206" title="All 4 branches covered.">        if (mIdentifiers == null || mIdentifiers.isEmpty()) {</span>
<span class="fc" id="L207">            return null;</span>
        }
<span class="fc" id="L209">        return mIdentifiers.get(0);</span>
    }

    /**
     * Convenience method to get the second identifier.
     * @return second identifier or null if not available.
     */
    public BeaconIdentifier getId2() {
<span class="fc bfc" id="L217" title="All 4 branches covered.">        if (mIdentifiers == null || mIdentifiers.size() &lt; 1) {</span>
<span class="fc" id="L218">            return null;</span>
        }
<span class="fc" id="L220">        return mIdentifiers.get(1);</span>
    }

    /**
     * Convenience method to get the third identifier.
     * @return third identifier or null if not available.
     */
    public BeaconIdentifier getId3() {
<span class="fc bfc" id="L228" title="All 4 branches covered.">        if (mIdentifiers == null || mIdentifiers.size() &lt; 2) {</span>
<span class="fc" id="L229">            return null;</span>
        }
<span class="fc" id="L231">        return mIdentifiers.get(2);</span>
    }

    /**
     * Gets the list of the multi-part identifiers of the beacon. Together, these identifiers signify
     * a unique beacon. The identifiers are ordered by significance for the purpose of grouping
     * beacons.
     * @return list of identifiers of the beacon or null if not available.
     */
    public List&lt;BeaconIdentifier&gt; getIdentifiers() {
<span class="fc bfc" id="L241" title="All 2 branches covered.">        return mIdentifiers != null ? Collections.unmodifiableList(mIdentifiers) : null;</span>
    }

    /**
     * Returns the calibrated measured Tx power of the Beacon in RSSI (expressed in dBm's).
     * This value is baked into a Beacon when it is manufactured, and it is
     * transmitted with each packet to aid in the distance estimate.
     * @return the calibrated measured Tx power.
     */
    public double getTransmittedPower() {
<span class="fc" id="L251">        return mTransmittedPower;</span>
    }

    /**
     * Gets the bluetooth mac address.
     * @return bluetooth mac address.
     */
    public String getBluetoothAddress() {
<span class="fc" id="L259">        return mBluetoothAddress;</span>
    }

    /**
     * Gets the two byte value indicating the type of beacon that this is, which is used for figuring
     * out the byte layout of the beacon advertisement.
     * @return two byte vlaue indicating the type of beacon.
     */
    public int getBeaconTypeCode() {
<span class="fc" id="L268">        return mBeaconTypeCode;</span>
    }


    /**
     * Gets the Bluetooth device name. This is a field transmitted by the remote beacon device separate
     * from the advertisement data.
     * @return bluetooth device name.
     */
    public String getBluetoothName() {
<span class="fc" id="L278">        return mBluetoothName;</span>
    }

    /**
     * Gets a two byte code indicating the beacon manufacturer. A list of registered manufacturer codes
     * may be found here:
     * https://www.bluetooth.org/en-us/specification/assigned-numbers/company-identifiers
     *
     * If the beacon is a GATT-based beacon, this field will be set to -1.
     * @return a two byt ecode indicating the beacon manufacturer.
     */
    public int getManufacturer() {
<span class="fc" id="L290">        return mManufacturer;</span>
    }

    /**
     * Gets a 32 bit service uuid for the beacon.
     * This is valid only for GATT-based beacons. If the beacon is a manufacturer data-based
     * beacon, this field will be -1
     * @return service uuid.
     */
    public int getServiceUuid() {
<span class="fc" id="L300">        return mServiceUuid;</span>
    }

    /**
     * Gets frequency used by this radio source (expressed in Hz).
     * @return frequency used by this radio source (expressed in Hz).
     */
    @Override
    public double getFrequency() {
<span class="fc" id="L309">        return mFrequency;</span>
    }

    /**
     * Checks whether two beacons are considered equal if they share the same identifiers.
     * @param that beacon to be compared.
     * @return true if both beacons are considered equal, false otherwise.
     */
    @Override
    public boolean equals(Object that) {
<span class="fc bfc" id="L319" title="All 2 branches covered.">        if (!(that instanceof Beacon)) {</span>
<span class="fc" id="L320">            return false;</span>
        }

<span class="fc" id="L323">        Beacon thatBeacon = (Beacon)that;</span>
<span class="pc bpc" id="L324" title="1 of 2 branches missed.">        return mIdentifiers != null &amp;&amp;</span>
<span class="fc bfc" id="L325" title="All 2 branches covered.">                mIdentifiers.equals(thatBeacon.mIdentifiers);</span>
    }

    /**
     * Computes hash code for this instance.
     * @return this instance hash code.
     */
    @Override
    public int hashCode() {
<span class="fc" id="L334">        return mIdentifiers.hashCode();</span>
    }

    /**
     * Gets radio source type, which can be either a WiFi Access point or a bluetooth Beacon.
     * @return radio source type.
     */
    @Override
    public RadioSourceType getType() {
<span class="fc" id="L343">        return RadioSourceType.BEACON;</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.2.201808211720</span></div></body></html>