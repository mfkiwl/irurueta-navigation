<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>AltBeaconUtils.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">com.irurueta:irurueta-navigation</a> &gt; <a href="index.source.html" class="el_package">com.irurueta.navigation.indoor</a> &gt; <span class="el_source">AltBeaconUtils.java</span></div><h1>AltBeaconUtils.java</h1><pre class="source lang-java linenums">/*
 * Copyright (C) 2018 Alberto Irurueta Carro (alberto@irurueta.com)
 *
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *         http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
package com.irurueta.navigation.indoor;

/**
 * Utility class to handle Android's AltBeacon library coefficients used te determine distance for calibrated devices.
 * AltBeacon uses the following formula to estimate Beacon's distance:
 * d = coefficient1 * ratio^coefficient2 + coefficient3
 * &lt;p&gt;
 * Considered that radio signal propagation follows equation:
 * Pr = Pt * k / d^n,
 * where:
 * - Pr is received signal strength (expressed in mW),
 * - Pt is transmitted signal strength (expressed in mW),
 * - k is equal to k = c / (4 * pi * f), where:
 * - c is speed of light (which is aproximately 9*10^8 m/s)
 * - f is the radio link frequency used by the beacon.
 * &lt;p&gt;
 * Hence, considering:
 * ratio = Pr / Pt
 * &lt;p&gt;
 * which is equal to:
 * ratio = k / d^n
 * &lt;p&gt;
 * And isolating d, whe obtain that:
 * d^n = k / ratio
 * &lt;p&gt;
 * d = (k / ratio)^(1/n)
 * d = k^(1/n)*ratio^(-1/n)
 * &lt;p&gt;
 * And thus we can see from this last expression that:
 * coefficient1 = k^(1/n) = (c / (4 * pi * f))^(1/n)
 * coefficient2 = -1/n, where n is the path loss exponent and depends on the
 * environment where the device is used (typically on free space n is equal to
 * 2.0, but can usually range from 1.6 to 1.8 on indoor environments)
 * coefficient3 is a bias term calibrated for each device.
 */
@SuppressWarnings(&quot;WeakerAccess&quot;)
public class AltBeaconUtils {

    /**
     * Speed of light expressed in meters per second (m/s).
     */
    public static final double SPEED_OF_LIGHT = 299792458.0;

    /**
     * Constructor to prevent instantiation of utility class.
     */
    private AltBeaconUtils() {
    }

    /**
     * Gets k value using provided frequency.
     * K is defined as k = c / (4 * pi * f), where:
     * - c is the speed of light expressed in m/s.
     * - f is the frequency expressed in Hz.
     *
     * @param frequency a frequency (expressed in Hz).
     * @return k value.
     */
    public static double getK(final double frequency) {
        //k = c / (4 * pi * f)
<span class="fc" id="L76">        return SPEED_OF_LIGHT / (4.0 * Math.PI * frequency);</span>
    }

    /**
     * Gets k value using AltBeacon's coefficients.
     *
     * @param coefficient1 1st coefficient.
     * @param coefficient2 2nd coefficient.
     * @return k value.
     */
    public static double getK(
            final double coefficient1, final double coefficient2) {
        //coefficient1 = k^(1/n), hence
        //k = coefficient1^n
<span class="fc" id="L90">        final double n = -1.0 / coefficient2;</span>
<span class="fc" id="L91">        return Math.pow(coefficient1, n);</span>
    }

    /**
     * Gets frequency from k value.
     *
     * @param k k value.
     * @return frequency expressed in Hz.
     */
    public static double getFrequency(final double k) {
        //k = c / (4*pi*f) --&gt; f = c / (4*pi*k)
<span class="fc" id="L102">        return SPEED_OF_LIGHT / (4.0 * Math.PI * k);</span>
    }

    /**
     * Gets frequency using AltBeacon's coefficients.
     *
     * @param coefficient1 1st coefficient.
     * @param coefficient2 2nd coefficient.
     * @return frequency expressed in Hz.
     */
    public static double getFrequency(
            final double coefficient1, final double coefficient2) {
<span class="fc" id="L114">        return getFrequency(getK(coefficient1, coefficient2));</span>
    }

    /**
     * Gets path loss exponent using AltBeacon's coefficient.
     *
     * @param coefficient2 2nd coefficient.
     * @return path loss exponent.
     */
    public static double getPathLossExponent(final double coefficient2) {
        //coefficient2 = -1/n
<span class="fc" id="L125">        return -1.0 / coefficient2;</span>
    }

    /**
     * Gets distance using AltBeacon's coefficients.
     *
     * @param coefficient1 1st coefficient.
     * @param coefficient2 2nd coefficient.
     * @param coefficient3 3rd coefficient.
     * @param ratio        ratio between received power and transmitted power.
     * @return distance expressed in meters.
     */
    public static double getDistance(
            final double coefficient1, final double coefficient2,
            final double coefficient3, final double ratio) {
        //d = coefficient1 * ratio^coefficient2 + coefficient3
<span class="fc" id="L141">        return coefficient1 * Math.pow(ratio, coefficient2) + coefficient3;</span>
    }

    /**
     * Gets distance using AltBeacon's coefficients.
     *
     * @param coefficient1     1st coefficient.
     * @param coefficient2     2nd coefficient.
     * @param coefficient3     3rd coefficient.
     * @param receivedPower    received power (expressed in mW).
     * @param transmittedPower transmitted power (expressed in mW).
     * @return distance expressed in meters.
     */
    public static double getDistance(
            final double coefficient1, final double coefficient2,
            final double coefficient3, final double receivedPower,
            final double transmittedPower) {
<span class="fc" id="L158">        return getDistance(coefficient1, coefficient2, coefficient3,</span>
                receivedPower / transmittedPower);
    }

    /**
     * Gets power ratio between received power and transmitted power
     * using AltBeacon's coefficients.
     *
     * @param coefficient1 1st coefficient.
     * @param coefficient2 2nd coefficient.
     * @param coefficient3 3rd coefficient.
     * @param distance     distance expressed in meters.
     * @return power ratio.
     */
    public static double getRatio(
            final double coefficient1, final double coefficient2,
            final double coefficient3, final double distance) {
        //d = coefficient1 * ratio^coefficient2 + coefficient3
        //d - coefficient3 = coefficient1 * ratio^coefficient2
        //(d - coefficient3) / coefficient1 = ratio^coefficient2
        //ratio = ((d - coefficient3) / coefficient1)^(1/coefficient2)
<span class="fc" id="L179">        return Math.pow((distance - coefficient3) / coefficient1,</span>
                1.0 / coefficient2);
    }

    /**
     * Gets power ratio between received power and transmitted power.
     *
     * @param receivedPower    received power (expressed in mW).
     * @param transmittedPower transmitted power (expressed in mW).
     * @return power ratio.
     */
    public static double getRatio(
            final double receivedPower, final double transmittedPower) {
<span class="fc" id="L192">        return receivedPower / transmittedPower;</span>
    }

    /**
     * Gets received power.
     *
     * @param ratio            ratio between received power and transmitted power.
     * @param transmittedPower transmitted power (expressed in mW).
     * @return received power (expressed in mW).
     */
    public static double getReceivedPower(
            final double ratio, final double transmittedPower) {
        //ratio = Pr / Pt
<span class="fc" id="L205">        return ratio * transmittedPower;</span>
    }

    /**
     * Gets received power using AltBeacon's coefficients.
     *
     * @param coefficient1     1st coefficient.
     * @param coefficient2     2nd coefficient.
     * @param coefficient3     3rd coefficient.
     * @param distance         distance expressed in meters.
     * @param transmittedPower transmitted power expressed in mW.
     * @return received power expressed in mW.
     */
    public static double getReceivedPower(
            final double coefficient1, final double coefficient2,
            final double coefficient3, final double distance,
            final double transmittedPower) {
<span class="fc" id="L222">        return getReceivedPower(getRatio(coefficient1, coefficient2, coefficient3,</span>
                distance), transmittedPower);
    }

    /**
     * Gets transmitted power.
     *
     * @param ratio         ratio between received power and transmitted power.
     * @param receivedPower received power expressed in mW.
     * @return transmitted power expressed in mW.
     */
    public static double getTransmittedPower(
            final double ratio, final double receivedPower) {
        //ratio = Pr / Pt
<span class="fc" id="L236">        return receivedPower / ratio;</span>
    }

    /**
     * Gets transmitted power using AltBeacon's coefficients.
     *
     * @param coefficient1  1st coefficient.
     * @param coefficient2  2nd coefficient.
     * @param coefficient3  3rd coefficient.
     * @param distance      distance expressed in meters.
     * @param receivedPower received power expressed in mW.
     * @return transmitted power expressed in mW.
     */
    public static double getTransmittedPower(
            final double coefficient1, final double coefficient2,
            final double coefficient3, final double distance,
            final double receivedPower) {
<span class="fc" id="L253">        return getTransmittedPower(getRatio(coefficient1, coefficient2,</span>
                coefficient3, distance), receivedPower);
    }

    /**
     * Gets AltBeacon's 1st coefficient.
     *
     * @param k                k value.
     * @param pathLossExponent path loss exponent.
     * @return AltBeacon's 1st coefficient.
     */
    public static double getCoefficient1(
            final double k, final double pathLossExponent) {
        //coefficient1 = k^(1/n)
<span class="fc" id="L267">        return Math.pow(k, 1.0 / pathLossExponent);</span>
    }

    /**
     * Gets AltBeacon's 1st coefficient.
     *
     * @param frequency        frequency expressed in Hz.
     * @param pathLossExponent path loss exponent.
     * @return AltBeacon's 1st coefficient.
     */
    public static double getCoefficient1WithFrequency(
            final double frequency, final double pathLossExponent) {
<span class="fc" id="L279">        return getCoefficient1(getK(frequency), pathLossExponent);</span>
    }

    /**
     * Gets AltBeacon's 2nd coefficient.
     *
     * @param pathLossExponent path loss exponent.
     * @return AltBeacon's 2nd coefficient.
     */
    public static double getCoefficient2(final double pathLossExponent) {
        //coefficient2 = -1/n
<span class="fc" id="L290">        return -1.0 / pathLossExponent;</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.2.201808211720</span></div></body></html>